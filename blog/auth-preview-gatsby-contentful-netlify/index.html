<!DOCTYPE html><html lang="en"><head><title>colin tinney</title><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato|Open+Sans"/><link rel="shortcut icon" type="image/x-icon" href="/favicon.png"/><style data-href="/styles.39072bde261c11e8f39d.css">body{color:#212028;background-color:#f8f8fc}.theme-module--primary--2gCmC{color:#0b5a9e}.theme-module--primary--2gCmC:hover{color:rgba(11,90,158,.65);color:#1f6eb2}.theme-module--secondary--3Ivxu,a{color:#d85f4f}.theme-module--secondary--3Ivxu:hover,a:hover{color:rgba(216,95,79,.65);color:#e98477}.theme-module--button--3TIWR{border-radius:3px;background-color:#fff;box-shadow:0 2px 3px rgba(0,0,0,.16),0 2px 3px rgba(0,0,0,.23)}.ScrollUp-module--container--1jk2T{position:relative;background-color:hsla(0,0%,100%,.85);border:1px solid rgba(53,180,222,.8);padding:.35rem}.ScrollUp-module--container--1jk2T:hover{color:#35b4de;top:-1px}.DefaultLayout-module--content--29qSQ{flex:1 1;justify-content:center;align-items:center}a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,mark,menu,nav,object,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}*{box-sizing:border-box}html{font-family:Lato,Helvetica,Arial,sans-serif;font-size:16px}.gatsby__body,.gatsby__body>*,body{display:flex;flex-direction:column;height:100vh;margin:0;line-height:1}h1,h2{display:block;font-weight:700}h1{margin:.5em 0;font-size:2em}h2{font-size:1.33em}h3{font-size:1.2rem}h4{font-weight:700}p{margin:1em 0;line-height:1.25em}li{line-height:1.45rem}strong{font-weight:700}a{text-decoration:none!important}.custom-block.box-shadow{box-shadow:0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23)}code.language-text{background-color:#ebebf0!important;color:#2d2d2d!important}.svg-inline--fa,svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:.08em solid #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s linear infinite;animation:fa-spin 2s linear infinite}.fa-pulse{-webkit-animation:fa-spin 1s steps(8) infinite;animation:fa-spin 1s steps(8) infinite}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.fa-rotate-90{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";-webkit-transform:scaleX(-1);transform:scaleX(-1)}.fa-flip-vertical{-webkit-transform:scaleY(-1);transform:scaleY(-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical,.fa-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)"}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1);transform:scale(-1)}:root .fa-flip-both,:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-90,:root .fa-rotate-180,:root .fa-rotate-270{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.Anchor-module--root--YVsPQ{text-decoration:none}.Brand-module--header--31XTZ{display:inline-block;padding:0 4px;cursor:default}.Brand-module--headerLarge--3iweP{font-size:3em;text-shadow:.5px .5px 1px #d85f4f}.Brand-module--headerUnderline--MdpAa{border-bottom:1px solid #828282}.Brand-module--link--1EETb{color:#212028!important}.Brand-module--link--1EETb:hover{color:#605e6e!important}@media (max-width:576px){.Brand-module--header--31XTZ:not(.Brand-module--headerLarge--3iweP){font-size:1.2rem}}.PageHeader-module--header--tcRE8{display:flex;min-height:50px;line-height:50px;align-items:baseline;border-bottom:1px solid rgba(15,15,15,.4)}.PageHeader-module--brand--1ll61{white-space:nowrap;margin:0}.PageHeader-module--separator--wERsr,.PageHeader-module--title--DVS2O{padding-bottom:2px;align-self:flex-end}.PageHeader-module--separator--wERsr{margin:0 10px}.PageHeader-module--title--DVS2O{cursor:pointer;word-break:break-word;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.PageHeader-module--titleLink--2XDi0{color:#000}.PageHeader-module--desktopMenu--mKr6-,.PageHeader-module--mobileMenu--3xCV1{margin-left:auto;padding:1px 0}.PageHeader-module--desktopMenuItem--3Nn-o{font-size:1.1em;margin:0 .5em}.PageHeader-module--mobileMenu--3xCV1{display:none;z-index:100}.PageHeader-module--popoverMenu--155gv{display:flex;flex-direction:column;align-items:flex-end;width:100vw;padding:.5em;font-size:1.4rem;background-color:#fff;box-shadow:3px 3px 6px rgba(15,15,15,.5)}.PageHeader-module--popoverMenuItem--3jEV5{padding:.5em}@media (max-width:576px){.PageHeader-module--header--tcRE8{padding:.4em 0;min-height:35px;line-height:35px;align-items:center}.PageHeader-module--separator--wERsr{margin:0 4px}.PageHeader-module--title--DVS2O{font-size:1em;padding-top:2px}.PageHeader-module--desktopMenu--mKr6-{display:none}.PageHeader-module--mobileMenu--3xCV1{display:initial}.PageHeader-module--menuIconContainer--33JkZ{align-self:center}}.PageLayout-module--container--1M1M-{margin-left:auto;margin-right:auto;max-width:50rem;padding:0 1.3125rem 2.625rem;display:flex;flex-direction:column;height:100%}.BlogLayout-module--container--1RL-p{padding:0 1.25rem;min-width:50vw}@media (max-width:576px){.BlogLayout-module--container--1RL-p{padding:0}}code{padding:0;font-size:.8rem;white-space:pre-wrap!important;word-wrap:break-word!important}blockquote{margin-left:.5em}.BlogPost-module--title--2xO8Q{margin-bottom:0}.BlogPost-module--date--2j-Kp{font-size:.75rem}.BlogPost-module--content--1ls3b{font-family:Open Sans,sans-serif;font-size:.95em}.BlogPost-module--content--1ls3b>h3{margin-top:.75rem;font-weight:600}.BlogPost-module--content--1ls3b a{text-decoration:underline}.BlogPost-module--content--1ls3b li>p{margin:0}.BlogPost-module--footer--wVByx{display:flex;justify-content:space-evenly;border-top:1px solid rgba(15,15,15,.4);margin-top:1.5em;padding:1em .25em}.BlogPost-module--footerPageLink--2nABz{max-width:50%;text-align:center}.PageNotFound-module--container--3TCwI{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}.PageNotFound-module--truth--3eCzK{margin-top:.7rem;font-size:.7rem}.Blog-module--preview--2DQWM{display:flex;flex-direction:column;box-sizing:content-box;overflow:hidden;margin-top:1rem}.Blog-module--previewTitle--2ilE7{margin:0}.Blog-module--previewDate--1idPA{font-size:.75rem;margin-top:.5rem;padding-left:.25rem}.Blog-module--previewExcerpt--1aiLt{overflow:hidden;max-height:140px;font-family:Merriweather,Georgia,serif;margin:0;padding:.75rem 0}.AnchorButton-module--anchorButton--1JBGY{position:relative;width:100px;margin:0 .5rem;padding:6px;-webkit-transition:top 1s ease;transition:top 1s ease}.AnchorButton-module--anchorButton--1JBGY:hover{top:-1px}.AnchorButton-module--primary--1USBH{border:1px solid #0b5a9e}.AnchorButton-module--primary--1USBH:hover{border-color:rgba(11,90,158,.65)}.AnchorButton-module--secondary--1w4TR{border:1px solid #a82d1c}.AnchorButton-module--secondary--1w4TR:hover{border-color:rgba(168,45,28,.65)}.ContactCard-module--container--4YL94{display:flex;flex-direction:column;align-items:center;width:34em;max-width:90%;margin-left:auto;margin-right:auto}.ContactCard-module--icon--pIjdG{margin:0 6px}.ContactCard-module--email__icon--24Mk1{vertical-align:text-bottom}.ContactCard-module--container__email--4CQt3,.ContactCard-module--container__social--WE9Rx{color:#424242!important;margin-bottom:1em}.ContactCard-module--container__email--4CQt3 a,.ContactCard-module--container__social--WE9Rx a{color:#424242}.ContactCard-module--container__email--4CQt3 a:hover,.ContactCard-module--container__social--WE9Rx a:hover{color:rgba(66,66,66,.7);color:#585858}.PageLinks-module--container--2TSdt{display:flex;justify-content:center;margin-bottom:1rem}.Home-module--container--34imV{width:34em;max-width:90%;margin-left:auto;margin-right:auto;text-align:center;display:flex;flex-direction:column;height:100%;justify-content:center}.Home-module--brand--1Xqpn{margin-bottom:0}.Home-module--contactCard--1fMpw{padding-top:1rem;border-top:1px solid rgba(15,15,15,.4)}.ProjectCard-module--card--ge1Xc{position:relative;display:flex;flex-direction:column;width:100%;padding:1rem;margin:.5rem;-webkit-transition:top 1s ease;transition:top 1s ease}.ProjectCard-module--card--ge1Xc:hover{top:-1px}@media (min-width:400px){.ProjectCard-module--card--ge1Xc{width:75%}}@media (min-width:500px){.ProjectCard-module--card--ge1Xc{width:45%}}.ProjectCard-module--shortDescription--3122_{margin:.35rem 0;font-size:.9rem;height:2rem}.ProjectCard-module--techStack--88ck-{font-size:.8rem;font-style:italic}.ProjectCard-module--links--1pxvy{display:flex;justify-content:space-around;margin-top:auto}.ProjectCard-module--link--2RrS3{margin:0 .5rem}.Projects-module--projects--2xfON{display:flex;flex-wrap:wrap;justify-content:center;box-sizing:content-box;padding:1rem 0}</style><meta name="generator" content="Gatsby 2.3.29"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">blog - Creating an authenticated preview site for Gatsby and Contentful using Netlify Identity</title><meta data-react-helmet="true" name="description" content="
Learn how to setup a preview instance of your Gatsby site using the Contentful Preview API
and authenticate it using Netlify Identity with Google OAuth.

"/><meta data-react-helmet="true" property="og:title" content="blog - Creating an authenticated preview site for Gatsby and Contentful using Netlify Identity"/><meta data-react-helmet="true" property="og:description" content="
Learn how to setup a preview instance of your Gatsby site using the Contentful Preview API
and authenticate it using Netlify Identity with Google OAuth.

"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-4bd01c7ec494d0b40848.js"/><link as="script" rel="preload" href="/app-a7a8157774481983df47.js"/><link as="script" rel="preload" href="/styles-946fb3b8c37fb0b7de68.js"/><link as="script" rel="preload" href="/1-e202c8160239d8ee49c1.js"/><link as="script" rel="preload" href="/2-77dec665664ed2260251.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-blog-post-js-3179485fe2a1428db38d.js"/><link as="fetch" rel="preload" href="/static/d/214/path---blog-auth-preview-gatsby-contentful-netlify-355-02d-O1NEacvsWRXuvOX0BH2qasEE.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby" class="gatsby__body"><div style="outline:none" tabindex="-1" role="group"><main class="DefaultLayout-module--content--29qSQ" aria-label="Content"><div class="PageLayout-module--container--1M1M-"><header class="PageHeader-module--header--tcRE8"><h1 class="Brand-module--header--31XTZ  PageHeader-module--brand--1ll61"><a class="Anchor-module--root--YVsPQ theme-module--primary--2gCmC Brand-module--link--1EETb" href="/">colin tinney</a></h1><span class="PageHeader-module--separator--wERsr">/</span><h3 class="PageHeader-module--title--DVS2O"><a class="Anchor-module--root--YVsPQ theme-module--primary--2gCmC PageHeader-module--titleLink--2XDi0" href="/blog">blog</a></h3><span class="PageHeader-module--desktopMenu--mKr6-"><a class="PageHeader-module--desktopMenuItem--3Nn-o" href="/blog">blog</a><a class="PageHeader-module--desktopMenuItem--3Nn-o" href="/projects">projects</a></span><span class="PageHeader-module--mobileMenu--3xCV1"><div style="width:24px;height:20px;position:relative;transform:rotate(0deg)"><span style="display:block;height:1px;width:100%;background:black;transition-timing-function:ease;transition-duration:0.4s;border-radius:0px;transform-origin:center;position:absolute;transform:translate3d(0,0,0) rotate(0);margin-top:-0.5px"></span><span style="display:block;height:1px;width:100%;background:black;transition-timing-function:ease-out;transition-duration:0.1s;border-radius:0px;transform-origin:center;position:absolute;opacity:1;top:10px;margin-top:-0.5px"></span><span style="display:block;height:1px;width:100%;background:black;transition-timing-function:ease;transition-duration:0.4s;border-radius:0px;transform-origin:center;position:absolute;transform:translate3d(0,20px,0) rotate(0);margin-top:-0.5px"></span></div></span></header><main class="BlogLayout-module--container--1RL-p"><article><header><h1 class="BlogPost-module--title--2xO8Q">Creating an authenticated preview site for Gatsby and Contentful using Netlify Identity</h1><p class="BlogPost-module--date--2j-Kp">April 21, 2019</p></header><div class="BlogPost-module--content--1ls3b"><p>Learn how to setup a preview instance of your Gatsby site using the Contentful Preview API
and authenticate it using Netlify Identity with Google OAuth.</p>
<!-- end -->
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li>
<p><a href="#setup">Setup</a></p>
<ul>
<li><a href="#gatsby">Gatsby</a></li>
<li><a href="#netlify">Netlify</a></li>
<li><a href="#contentful">Contentful</a></li>
</ul>
</li>
<li><a href="#testing">Testing</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<h2 id="introduction"><a href="#introduction" aria-label="introduction permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>Contentful provides a <a href="https://www.contentful.com/developers/docs/references/content-preview-api/">Preview API</a> that returns unpublished content (e.g. draft blog posts) to allow users to preview this content on their website.</p>
<p>Setting up a server to host an instance of your Gatsby website that uses the Preview API and is accessible within a local/corporate network is relatively trivial. In my case, I am working with a remote content creator; we do not work on the same network nor do I have a dedicated local network available for VPN access. Gatsby provides <a href="https://www.gatsbyjs.org/docs/authentication-tutorial/">tutorials</a> on authenticating routes but in this case I want the entire website to be authenticated without having to re-create page routes.</p>
<p>The solution I came up with is to run a preview instance on Netlify that uses <a href="https://www.netlify.com/docs/identity/">Netlify Identity</a> for authentication and Netlify <a href="https://www.netlify.com/tags/deploy-contexts/">Deploy Contexts</a> to ensure that the builds on a target branch use the Preview API and turn on authentication. <a href="https://www.contentful.com/developers/docs/concepts/webhooks/">Contentful Webhooks</a> are used to trigger re-deploys on Netlify to ensure the preview website stays updated.</p>
<p><a
    class="gatsby-resp-image-link"
    href="/static/253f421c8389ffa2b4ed706a11f0ee89/72dbe/login.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 378px;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 117.1957671957672%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAADT0lEQVQ4y61UW08TQRTub9AH0RgfNFE0gon6ZtSoMSb6QoyAUcAQDcWABk180AcfjMTERMEbSkRjfNVEDF4RKVBKuXgXEBAN11Zpu9t22+62u93PM7NtXaCgMU7yZeac850zZ86ZGcuFS1fx+OkLPHjUgIf1T9KggdsMe3oOs9U3PMfF6huwtDu78L+Gs/sNLE22Vi7EYjFomjYN0HWIfj/ef/qMnncfIIgi587kMV82WtudsLxusXPB5f6BiUkXJl1uTHC4uO77yCi63r7Dmw8fMTI6hknGS3A4N+HDhr2j63fAKO2iqipBM6BpXI7H46kjaQldiqMacjSRob2j0xQwOvvISRhB1Dnt0Wh0dsAprxej4xPwCSIHy+xvoFOd0waMyDIUReEFZlBNmf0JSrqAyWDRJIgUS9X1HwL6A0FMebz8ani8Pg6WNRvsWPMhbVNkypBnRTsmj53MmGXP7Sa9GYpiytDW1s6FijNnkX/YisLSchRYywyUlKGo9BiOHD+JkopTfH2wpCxlL7SWY//hUpSfOg2NGtTR2QNLi93B0964bRcWLM/EktXrkLEqGxmZ2Vi0MgvLsjZg8+4cbNmTg6Vr13MdszHOYuIuXLEG2Zu2QabyOLvo6TW3Gke205t+2dyCppY2vEqArRtJZ6NNm+kkjXPYWx1OHoP9C6kazjfCERlSKPxHnt1haoquscKqM8C6p8PrccPz05Vwi83iGb4zuvzNHUH/mIyvLoWjf1xGH8m9oxEMuTWOvrEIeknHbEne4KTCfU1dNgIW13iwr0rEjkofdpwXcOCaiOJbfhyq8aPgOluLKKL1kVpD3k6cnZUCtp4TkFc1BVUHdZlqaEs05cQ9D4pvisir9iGXYL0touyOgKN1AkrrjNl6W8DJ+6S/KyK3yof8KwL2XiZ97RTo9zQCJo8cCEUhSjFIERVBAlsHZR1hKo+kgM8MgbAOwcQLhhlMNWyytXEhrqm8AbQyXk4kjMGhQXzq7cXwt2GaP+PLwAAGSKfIyY7HuY/hC7Q5eA0dhknXp10BJrKrwr4yNgeCQQQlia5QhD+E6VxDdnR2w9LwrJG/R/Yp+AOBFAL0WUihEELhsDFT0BDNkhTiNjOX+bIYL5ts+AVSBmdyv5dT2gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;"
        alt="Login screen"
        title=""
        src="/static/253f421c8389ffa2b4ed706a11f0ee89/72dbe/login.png"
        srcset="/static/253f421c8389ffa2b4ed706a11f0ee89/cbe86/login.png 148w,
/static/253f421c8389ffa2b4ed706a11f0ee89/eda7d/login.png 295w,
/static/253f421c8389ffa2b4ed706a11f0ee89/72dbe/login.png 378w"
        sizes="(max-width: 378px) 100vw, 378px"
      />
  </span>
  </a></p>
<p>To summarize the changes:</p>
<ul>
<li>
<p>Wrap Gatsby's root element in a higher-order component that uses Netlify Identity to check if the user is logged in</p>
<ul>
<li>If the user isn't logged in, redirect to a login screen</li>
</ul>
</li>
<li>Add support for environment variables to force builds to use the Contentful Preview API</li>
<li>Create a deploy context on Netlify for the target branch (e.g. <code class="language-text">develop</code> or <code class="language-text">preview</code>) that sets environment variables</li>
<li>Add a webhook to Contentful to trigger re-deploys for the target branch deploy context</li>
</ul>
<h2 id="prerequisites"><a href="#prerequisites" aria-label="prerequisites permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<p>This post will not cover how to set this up from scratch.</p>
<p>There are some prerequisites:</p>
<ul>
<li>
<p><a href="https://gatsbyjs.org">Gatsby</a> + <a href="https://contentful.com">Contentful</a> project</p>
<ul>
<li>I recommend using <a href="https://github.com/contentful-userland/gatsby-contentful-starter">the starter</a></li>
</ul>
</li>
<li><a href="https://netlify.com">Netlify</a> site linked to the project</li>
</ul>
<p>There are plenty of good resources online (<a href="https://www.contentful.com/r/knowledgebase/gatsbyjs-and-contentful-in-five-minutes/">1</a>, <a href="https://itnext.io/jamstack-basics-how-to-create-a-gatsby-starter-with-contentful-and-deploy-to-netlify-846354cc74bc">2</a>) you can use to learn how to set this up.</p>
<h2 id="setup"><a href="#setup" aria-label="setup permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup</h2>
<h3 id="gatsby"><a href="#gatsby" aria-label="gatsby permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Gatsby</h3>
<p>We can create a wrapper service for <code class="language-text">netlify-identity-widget</code> that our application can use to check if the user is authenticated and allow the user to login.</p>
<p>First, install it as a dependency via <code class="language-text">npm i -S netlify-identity-widget</code>.</p>
<p><code class="language-text">auth.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> netlifyIdentity <span class="token keyword">from</span> <span class="token string">'netlify-identity-widget'</span><span class="token punctuation">;</span>

<span class="token comment">// `window` won't be defined on SSR builds</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  netlifyIdentity<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>netlifyIdentity <span class="token operator">=</span> netlifyIdentity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  isAuthenticated<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isAuthenticated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    netlifyIdentity<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    netlifyIdentity<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token parameter">user</span> <span class="token operator">=></span> <span class="token function">callback</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">currentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> netlifyIdentity<span class="token punctuation">.</span><span class="token function">currentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Next, we create a higher-order component that we can use to wrap page components.</p>
<p><code class="language-text">withAuth.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> auth <span class="token keyword">from</span> <span class="token string">'./auth'</span><span class="token punctuation">;</span>

<span class="token comment">// We can check this before the component is rendered.</span>
<span class="token keyword">const</span> alreadyLoggedIn <span class="token operator">=</span> auth<span class="token punctuation">.</span>isAuthenticated
<span class="token operator">||</span> auth<span class="token punctuation">.</span><span class="token function">currentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">withAuth</span><span class="token punctuation">(</span><span class="token parameter">PageComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">WithAuthPageComponent</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>
      isLoggedIn<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      redirectPath<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// When it's first mounted, store the path name.</span>
      <span class="token comment">// This allows us to redirect to it after the user has logged in.</span>
      <span class="token keyword">const</span> path <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        redirectPath<span class="token punctuation">:</span> <span class="token operator">!</span>alreadyLoggedIn <span class="token operator">&amp;&amp;</span> path <span class="token operator">!==</span> <span class="token string">'/'</span>
          <span class="token operator">?</span> path
          <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> auth<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          isLoggedIn<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>
        isLoggedIn<span class="token punctuation">,</span>
        redirectPath<span class="token punctuation">,</span>
      <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLoggedIn <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>alreadyLoggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>button
            type<span class="token operator">=</span><span class="token string">"button"</span>
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>login<span class="token punctuation">}</span>
            <span class="token comment">// This will center the button vertically</span>
            <span class="token comment">// and horizontally. You don't need to do this necessarily.</span>
            style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
              left<span class="token punctuation">:</span> <span class="token string">'50%'</span><span class="token punctuation">,</span>
              top<span class="token punctuation">:</span> <span class="token string">'50%'</span><span class="token punctuation">,</span>
              transform<span class="token punctuation">:</span> <span class="token string">'translate(-50%, -50%)'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">></span>
            <span class="token constant">LOGIN</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>redirectPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>redirectPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>PageComponent <span class="token punctuation">{</span><span class="token operator">...</span>this<span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now, we can create the function to do the wrapping (based on an environment variable -- we'll cover that after).</p>
<p><code class="language-text">wrapRootElementWithAuth.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> withAuth <span class="token keyword">from</span> <span class="token string">'./withAuth'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> useAuth <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ENABLE_NETLIFY_AUTH</span> <span class="token operator">===</span> <span class="token string">'true'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">wrapRootElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  element<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">RootElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">></span>
      <span class="token punctuation">{</span>element<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>useAuth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>RootElement <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> ElementWithAuth <span class="token operator">=</span> <span class="token function">withAuth</span><span class="token punctuation">(</span>RootElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>ElementWithAuth <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

wrapRootElement<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  element<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>node<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> wrapRootElement<span class="token punctuation">;</span></code></pre></div>
<p>Now, we need to do the element wrapping via Gatsby's <a href="https://www.gatsbyjs.org/docs/browser-apis/">Browser APIs</a> and <a href="https://www.gatsbyjs.org/docs/node-apis/">Node APIs</a>. We can use <code class="language-text">wrapRootElement</code> specifically.</p>
<p><code class="language-text">gatsby-browser.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> wrapRootElementWithAuth <span class="token keyword">from</span> <span class="token string">'./src/auth/wrapRootElementWithAuth'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> wrapRootElement <span class="token operator">=</span> wrapRootElementWithAuth<span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">gatsby-node.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> wrapRootElementWithAuth <span class="token keyword">from</span> <span class="token string">'./src/auth/wrapRootElementWithAuth'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> wrapRootElement <span class="token operator">=</span> wrapRootElementWithAuth<span class="token punctuation">;</span></code></pre></div>
<p>Now, we need to add support for <code class="language-text">ENABLE_NETLIFY_AUTH</code>. Since we're using it on the client-side, we need to make it accessible to
modules. This can be accomplished with <a href="https://www.gatsbyjs.org/packages/gatsby-plugin-env-variables/"><code class="language-text">gatsby-plugin-env-variables</code></a>.</p>
<p>After installing it as a dependency (<code class="language-text">npm i -S gatsby-plugin-env-variables</code>), add the following lines to your <code class="language-text">gatsby-config.js</code> file:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">...</span>
plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  resolve<span class="token punctuation">:</span> <span class="token string">'gatsby-plugin-env-variables'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Variables in the whitelist will be available to builds as process.env.&lt;NAME>, just</span>
    <span class="token comment">// like Node processes</span>
    whitelist<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">'ENABLE_NETLIFY_AUTH'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">...</span></code></pre></div>
<p>Now, we must add environment variable support to switch to the Contentful Preview API.</p>
<p>Let's name this variable <code class="language-text">CONTENTFUL_USE_PREVIEW</code>.</p>
<p>With <code class="language-text">gatsby-source-contentful</code>, there is a <code class="language-text">host</code> option we can use. I moved plugin options to their own module for encapsulation.</p>
<p><strong>NOTE: You will need both Preview and Delivery API tokens setup in your build environment.</strong></p>
<p><code class="language-text">contentful-options.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// We can use dotenv to read environment variables from a file (e.g. local environment).</span>
<span class="token comment">// This is not required if you don't want to preview locally.</span>
<span class="token comment">// This does require you to install it as a dependency:</span>
<span class="token comment">//  `npm i -S dotenv`</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dotenv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">'.env'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>
  <span class="token constant">CONTENTFUL_SPACE_ID</span><span class="token punctuation">:</span> spaceId<span class="token punctuation">,</span>
  <span class="token constant">CONTENTFUL_USE_PREVIEW</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">;</span>
<span class="token keyword">const</span> usePreview <span class="token operator">=</span> <span class="token constant">CONTENTFUL_USE_PREVIEW</span> <span class="token operator">===</span> <span class="token string">'true'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> host <span class="token operator">=</span> usePreview
  <span class="token operator">?</span> <span class="token string">'preview.contentful.com'</span>
  <span class="token comment">// If `null`, defaults to the Delivery API </span>
  <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> accessToken <span class="token operator">=</span> usePreview
  <span class="token comment">// The Preview API uses a different token than the Delivery API</span>
  <span class="token operator">?</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CONTENTFUL_PREVIEW_TOKEN</span>
  <span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">CONTENTFUL_DELIVERY_TOKEN</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>spaceId <span class="token operator">||</span> <span class="token operator">!</span>accessToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
    <span class="token string">'Contentful spaceId and access token need to be provided'</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  spaceId<span class="token punctuation">,</span>
  host<span class="token punctuation">,</span>
  accessToken<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Then, pass them to the plugin as options:</p>
<p><code class="language-text">gatsby-config.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> contentfulOptions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./contentful-options'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">...</span>
plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  resolve<span class="token punctuation">:</span> <span class="token string">'gatsby-source-contentful'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> contentfulOptions
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">...</span></code></pre></div>
<h3 id="netlify"><a href="#netlify" aria-label="netlify permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Netlify</h3>
<p>Now, we need to setup Netlify to support authenticated builds using the Preview API.</p>
<ol>
<li>
<p>Add the following environment variables:</p>
<ul>
<li><code class="language-text">CONTENTFUL_PREVIEW_TOKEN</code> - Contentful API token</li>
</ul>
</li>
<li>
<p>Add a deploy context (<code class="language-text">Site settings &gt; Build &amp; deploy &gt; Deploy Contexts</code>) for the target branch, e.g. <code class="language-text">develop</code></p>
<p><a
    class="gatsby-resp-image-link"
    href="/static/538d81c70415213f32006f6058c5191b/e8943/branch-deploys.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 590px;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 41.36291600633915%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+0lEQVQoz31Sa0/DMAzs//9rfEBCCFhXFAbT1nXtRp5tyeOIk7Xa0Kil01mOdXHOKbgQODQN6uaI3b7Gj7WgCCEkKKWxrw+wse69XwT1F9Q4jGPGMMSDMAtSuNjIuYDSOkNlyAvrWBNSJpBogTsxiVEY06NiDG13yhc4d4PpJROKv4VZ7JLTrd+cpwlM30MbkyalnJjOr2NxQh/54ViDbbdgbIPVusJbucbLqkRZveO1rLCL/lK/tS7ZsyhIPHo3e0SeEdMipVIQQiamqaVUKb8reL1lCnpy07Y4nc9xCSafI8x84+GS2CTYdh0en57x8fkFGxdBvrl/vs4vGhJxGwzSXLcAAAAASUVORK5CYII='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;"
        alt="Deploy Contenxt"
        title=""
        src="/static/538d81c70415213f32006f6058c5191b/5186d/branch-deploys.png"
        srcset="/static/538d81c70415213f32006f6058c5191b/cbe86/branch-deploys.png 148w,
/static/538d81c70415213f32006f6058c5191b/eda7d/branch-deploys.png 295w,
/static/538d81c70415213f32006f6058c5191b/5186d/branch-deploys.png 590w,
/static/538d81c70415213f32006f6058c5191b/e8943/branch-deploys.png 631w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span>
  </a></p>
</li>
<li>
<p>Update your build settings via <code class="language-text">netlify.toml</code> to use authentication and the preview API</p>
<p><code class="language-text">netlify.toml</code>:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Settings for `develop` branch deploys.</span>
<span class="token comment"># If your target branch is named something else,</span>
<span class="token comment"># the context will be "context.&lt;NAME>.environment".</span>
<span class="token punctuation">[</span>context.develop.environment<span class="token punctuation">]</span>
  CONTENTFUL_USE_PREVIEW = "true"
  ENABLE_NETLIFY_AUTH = "true"</code></pre></div>
</li>
<li>
<p>Enable Identity, add Google as a provider, and <strong>set it to invite-only</strong></p>
</li>
<li>
<p>Finally, add a build hook for the <code class="language-text">develop</code> deploy context and copy it to your clipboard</p>
<p><a
    class="gatsby-resp-image-link"
    href="/static/fb99f928dbf79291198b713c158aa4c9/8ff6a/build-hook.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 355px;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 47.605633802816904%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3klEQVQoz6WR626DMAyF8/4v1mlAaSdN2/+13BISShi0FeHMTqWuFzRKZ+lTbCvx5UQ453BigBsG77MN5F/yqIkky6FKTZTQpoJUCn3f313kRlzYTSBqa6G1QSEVcilRUMG2bSmWKCkvVYlvirkgN+r5/APxtdkiXMbECgHxGsUw1Q7vH58IV29YBCE2SXqWYXLlsaS7ecixn+4BhDbGa7erayitYZvmSrO5CF6v7Tp0+70vZm3zq9cTiCRN8RJEiOK1123sh+eY4FW3aYYsL5DQeTge/zfhbYdndLvkBxFVDlQB7IHTAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;"
        alt="Build hook"
        title=""
        src="/static/fb99f928dbf79291198b713c158aa4c9/8ff6a/build-hook.png"
        srcset="/static/fb99f928dbf79291198b713c158aa4c9/cbe86/build-hook.png 148w,
/static/fb99f928dbf79291198b713c158aa4c9/eda7d/build-hook.png 295w,
/static/fb99f928dbf79291198b713c158aa4c9/8ff6a/build-hook.png 355w"
        sizes="(max-width: 355px) 100vw, 355px"
      />
  </span>
  </a></p>
</li>
</ol>
<h3 id="contentful"><a href="#contentful" aria-label="contentful permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contentful</h3>
<p>Finally, we need to setup Contentful to trigger re-deploys of <code class="language-text">develop</code> when content changes.</p>
<p>Open the Webhooks for your environment and add the copied build hook.</p>
<p><a
    class="gatsby-resp-image-link"
    href="/static/c8001183ae727e7f720450a0d76c9590/96891/webhooks.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 579px;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 32.98791018998273%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA2ElEQVQoz42RiwrCMAxF+/8fKCqKG8p0Puq6rutj4jWJHRsiaOGQR5feZFEhJYRIkPUxwocJyRPz3C+UNhamczDWwfnwfiALWOfRdn3OxT9IUI3t0eZC52PulB8c0PWB8EjDQ+L4AxZWRbFDXZ9QlgUSqch5PsX4EHBvWsG0VmhM9mkyfW8kHu/5KEcdcKHLnQyPiTRM6qP/LRdpKva5Ri2WK5T7A9abLQ7VUUZzvBCymtSr8xXH8w31VQuny43QQlVfJOZ7jnteCv+jOT4vZQ5/ODKPP33mBVxxHog9r2k3AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;"
        alt="Webhooks"
        title=""
        src="/static/c8001183ae727e7f720450a0d76c9590/96891/webhooks.png"
        srcset="/static/c8001183ae727e7f720450a0d76c9590/cbe86/webhooks.png 148w,
/static/c8001183ae727e7f720450a0d76c9590/eda7d/webhooks.png 295w,
/static/c8001183ae727e7f720450a0d76c9590/96891/webhooks.png 579w"
        sizes="(max-width: 579px) 100vw, 579px"
      />
  </span>
  </a></p>
<p>We can add linking from content to the preview website:</p>
<ol>
<li>
<p>Open <code class="language-text">Content Preview</code> for your environment</p>
</li>
<li>
<p>Select the content you want</p>
</li>
<li>
<p>Use the full Netlify URL for the preview URLs</p>
<ul>
<li>e.g. <code class="language-text">https://develop--projectname.netlify.com/blog/{entry.fields.slug}</code></li>
</ul>
<p><a
    class="gatsby-resp-image-link"
    href="/static/dc999e06c0b6058c5eb750bb2b362119/10327/content-preview-urls.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 515px;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 49.51456310679612%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVQoz61Sa0/DMAzs//+BoKzp0oy1Y0grzavd+sjhGDViEh8YYOlky3ZOl1yK8XpFCIExjiO89wjDAOscpmlCBBBj/DGKtj1BVoqwhz68oJQV56dngculw6NRZFWkcCBlCam39R0pNdbmHec8jDHc3+aW5htYodjtoOoaWmtIKRlCCFRVRYolyrIk1QfUtKOU4jqRfSXKhPRCWJYF/xXFNC9oSOWxaZn4EQO+NaXuIurjGU3ToKe3+U3cEd5uE30RnxEGMiMMcD5wTjDWc05zY12uE1K9rCtWIlspM2FPS4kgHXRM4Bjbod7YPO/eTSbuzefeHeE8z3g9v5HLmhzd05ewf7ryB+I7CHrfx3hDAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;"
        alt="Content Preview URLs"
        title=""
        src="/static/dc999e06c0b6058c5eb750bb2b362119/10327/content-preview-urls.png"
        srcset="/static/dc999e06c0b6058c5eb750bb2b362119/cbe86/content-preview-urls.png 148w,
/static/dc999e06c0b6058c5eb750bb2b362119/eda7d/content-preview-urls.png 295w,
/static/dc999e06c0b6058c5eb750bb2b362119/10327/content-preview-urls.png 515w"
        sizes="(max-width: 515px) 100vw, 515px"
      />
  </span>
  </a></p>
</li>
</ol>
<p>Then, a preview button will show up for creators on the right-side pane when creating content such as blog posts.</p>
<p><a
    class="gatsby-resp-image-link"
    href="/static/61a03906c1012e3a4d10bc7a3df704eb/0bd9d/preview-button.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 334px;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 34.13173652694611%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyElEQVQoz51Qyw6CMBDk/z/OGA1RUEBeKiCRV2nBw9itllSJxniYzG63M52t1fYcjAt0vUAvBvBh/Bukt8I0R5qViI45qpapQ3qAEf8KPkxhLJWODAzWdfc2M+czaENKVXUGZN+wXonpOwgN41Ndy9knjTKMswJJfpmQFiXcQ4yF7cDeB9gGkeqJN14IPzkhkXdMTSQ9zuUVYry9GsbaMEywdj0JHyvHU8bEy80OjjRPvxlS5PoZXTOt+FhZTKvrP2xkPdMYK98BPQQWeUjTXjsAAAAASUVORK5CYII='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px transparent;"
        alt="Preview button"
        title=""
        src="/static/61a03906c1012e3a4d10bc7a3df704eb/0bd9d/preview-button.png"
        srcset="/static/61a03906c1012e3a4d10bc7a3df704eb/cbe86/preview-button.png 148w,
/static/61a03906c1012e3a4d10bc7a3df704eb/eda7d/preview-button.png 295w,
/static/61a03906c1012e3a4d10bc7a3df704eb/0bd9d/preview-button.png 334w"
        sizes="(max-width: 334px) 100vw, 334px"
      />
  </span>
  </a></p>
<h2 id="testing"><a href="#testing" aria-label="testing permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing</h2>
<p>To test the setup, push the changes to the <code class="language-text">develop</code> branch after configuring Contentful and Netlify. Upon a successful deploy, you should be redirected to the login page when accessing the website.</p>
<h2 id="conclusion"><a href="#conclusion" aria-label="conclusion permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>Questions? E-mail me.</p></div></article><footer class="BlogPost-module--footer--wVByx"><a class="BlogPost-module--footerPageLink--2nABz" href="/blog/vscode-extensions">Some VS Code Extensions →</a></footer></main></div></main><div style="position:fixed;bottom:70px;right:30px;cursor:pointer;transition-duration:0.2s;transition-timing-function:linear;transition-delay:0s;opacity:0;visibility:hidden;transition-property:opacity, visibility"><div class="ScrollUp-module--container--1jk2T theme-module--button--3TIWR">up ↑</div></div></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-87415138-3',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-87415138-3', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-blog-post-js","jsonName":"blog-auth-preview-gatsby-contentful-netlify-355","path":"/blog/auth-preview-gatsby-contentful-netlify"};window.dataPath="214/path---blog-auth-preview-gatsby-contentful-netlify-355-02d-O1NEacvsWRXuvOX0BH2qasEE";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a7a8157774481983df47.js"],"component---src-templates-blog-post-blog-post-js":["/component---src-templates-blog-post-blog-post-js-3179485fe2a1428db38d.js"],"component---src-pages-404-js":["/component---src-pages-404-js-802bf2c6a15eb307b707.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-5e749cdbc68e6574af21.js"],"component---src-pages-blog-blog-js":["/component---src-pages-blog-blog-js-a77fc17ad9584b1ae89a.js"],"component---src-pages-blog-index-js":["/component---src-pages-blog-index-js-5c7af2b03dc964109ae7.js"],"component---src-pages-home-home-js":["/component---src-pages-home-home-js-6069abde5efa7ffa71f2.js"],"component---src-pages-home-index-js":["/component---src-pages-home-index-js-a48388f9dd06f2dbce0b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-bf1b15182ff14b5a4a0c.js"],"component---src-pages-page-not-found-index-js":["/component---src-pages-page-not-found-index-js-593c2659dc72fdfe2402.js"],"component---src-pages-page-not-found-page-not-found-js":["/component---src-pages-page-not-found-page-not-found-js-e16765e5d80255cd838d.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-ae4b623f65cb1e96493a.js"],"component---src-pages-projects-index-js":["/component---src-pages-projects-index-js-0b1e7bfb0afc4449468a.js"],"component---src-pages-projects-projects-js":["/component---src-pages-projects-projects-js-4d9fcf7543a6ef816837.js"],"pages-manifest":["/pages-manifest-4b53d97f07fa16030993.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-blog-post-js-3179485fe2a1428db38d.js" async=""></script><script src="/2-77dec665664ed2260251.js" async=""></script><script src="/1-e202c8160239d8ee49c1.js" async=""></script><script src="/styles-946fb3b8c37fb0b7de68.js" async=""></script><script src="/app-a7a8157774481983df47.js" async=""></script><script src="/webpack-runtime-4bd01c7ec494d0b40848.js" async=""></script></body></html>